---
import SidebarLayout from "../layouts/SidebarLayout.astro";

const DRIVE_ID = "1kT5FYy81tf49MghFeU6MbwdBPgZIoiCB";
const title = "La Régence — Bar-Brasserie à Mont-de-Marsan";
const description = "Cuisine maison le midi & le soir, café, bières, cocktails. Terrasse conviviale.";

const today = new Date().toISOString().slice(0, 10);
const menuPrimary = `https://drive.google.com/uc?export=view&id=${DRIVE_ID}&v=${today}`;
const menuFallback = `https://drive.google.com/thumbnail?id=${DRIVE_ID}&sz=w1600&v=${today}`;
---
<SidebarLayout {title} {description}>
  <!-- SPLASH (on garde TA version existante, ci-dessous rappel abrégé) -->
  <div
    id="splash"
    class="fixed inset-0 z-50 bg-brand text-[var(--color-bg)]
           flex flex-col items-center justify-center
           transform-gpu translate-y-0 transition-transform duration-[1800ms] ease-out"
  >
    <!-- Trait à 90% -->
    <div class="absolute left-0 right-0" style="top:90%; height:3px; background:#a3742c;"></div>
    <!-- Copyright à ~92% -->
    <div class="absolute w-full text-center text-sm opacity-80 flex flex-col items-center" style="top:92%;">
      <img src="/logo.png" alt="La Régence" class="w-6 h-6 mb-1 opacity-90" />
      <p>© La Régence 2025</p>
    </div>

    <!-- Contenu qui fade-in + Limelight -->
    <div class="flex flex-col items-center gap-5 fade-in-contents font-splash">
      <img src="/logo.png" alt="La Régence" class="w-60 h-60 md:w-72 md:h-72 lg:w-80 lg:h-80 object-contain" />
      <p class="text-2xl md:text-3xl">Bar-Brasserie à Mont-de-Marsan</p>
    </div>
  </div>

  <!-- CONTENU (colonne droite 4/5) -->
  <section class="p-6">
    <div class="grid md:grid-cols-2 gap-6 items-start">
      <div class="space-y-4">
        <h1 class="text-3xl font-extrabold text-brand">Bienvenue à La Régence</h1>
        <p class="text-slate-700">
          Cuisine maison, produits frais. Service le midi en semaine et le soir du lundi au samedi.
          Bar, café, cocktails et vins — ambiance conviviale en plein centre-ville.
        </p>
        <div class="flex gap-3">
          <a href="/menu" class="btn btn-primary">Voir la carte</a>
          <a href="/contact" class="btn btn-outline">Contact</a>
        </div>
      </div>

      <div class="grid gap-4">
        <div class="rounded-2xl soft-border overflow-hidden">
          <img
            id="heroDynamic"
            src="/bar.jpg"
            alt="La Régence — visuel"
            class="w-full h-64 md:h-80 object-cover"
            data-primary={menuPrimary}
            data-fallback={menuFallback}
          />
        </div>
        <div class="rounded-2xl soft-border overflow-hidden">
          <img src="/bar-small.jpg" alt="La Régence — intérieur" class="w-full h-40 object-cover" />
        </div>
      </div>
    </div>
  </section>

  <!-- Script: splash + image dynamique -->
  <script is:inline>
    (function () {
      const s = document.getElementById('splash');
      if (!s) return;
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const go = () => {
        if (prefersReduced) { s.remove(); return; }
        s.classList.add('slide-up-out');
        s.addEventListener('transitionend', () => s.remove(), { once: true });
      };
      window.addEventListener('load', () => setTimeout(go, 2000)); // ← ajuste ici le délai
    })();

    (function () {
      const img = document.getElementById('heroDynamic');
      if (!img) return;

      const params = new URLSearchParams(location.search);
      const forceMenu = params.get('showMenu') === '1';
      const now = new Date();
      const hh = Number(new Intl.DateTimeFormat('fr-FR', {
        hour: '2-digit', hour12: false, timeZone: 'Europe/Paris'
      }).format(now));

      if (forceMenu || (hh >= 10 && hh < 15)) {
        const primary = img.dataset.primary;
        const fallback = img.dataset.fallback;
        const test = new Image();
        test.onload = () => { img.src = primary };
        test.onerror = () => { img.src = fallback };
        test.src = primary;
      }
    })();
  </script>
</SidebarLayout>
